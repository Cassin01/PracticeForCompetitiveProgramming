<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="4617043 神保光洋" />
  <title>情報工学実験２</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  
</head>
<body>
<header id="title-block-header">
<h1 class="title">情報工学実験２</h1>
<p class="author">4617043 神保光洋</p>
</header>
<h1 id="webアプリケーションの仕組みについて">Webアプリケーションの仕組みについて</h1>
<p>Web アプリケーションでは、アプリケーションに関する処理はほぼ全てサーバで行われる。 このため、アプリケーションに新たな機能が追加された場合や、新たに別のアプリケーションのサービスを受ける場合や、 新たに別のアプリケーションのサービスを受ける場合などにおいても、サービスを提供する側のサーバソフトウェアを変更するだけで 良く、利用者側は何も変更することなく新たなサービスが受けられる。</p>
<p>サーバーはクライアントからの要求に従いHTMLや画像データなどを送信し、Webブラウザはそのデータを表示する。サーバは、 クライアントからのリクエストを待ち受けており、クライアントからの要求が到着すると処理を行い、 レスポンスを返す。また、サーバはクライアントの要求を解釈し、クライアントはサーバの応答を解釈する必要がある。 この要求・応答のやり取りの方式や解釈の方式の取り決めをHTTPと呼ぶ。以下が処理の概要である。</p>
<ol type="1">
<li><p>クライアントからサーバに対して接続を行う。すなわち、TCPによるコネクションの確立が行われ、 双方のコンピュータ同士で通信が可能となる。</p></li>
<li><p>クライアントからサーバに対し、「指定したURLの内容を送れ」という意味の要求が送られる。 URLとは、インターネット上のリソースを示す記述法である。</p></li>
<li><p>サーバは要求されたURLに対するデータや、サーバプログラムによって処理された結果をクライアントに対して送信する。 クライアントであるWebブラウザでは、返ってきたデータに表示する。</p></li>
</ol>
<p>Webアプリケーションの機能を提供するサーバをWebアプリケーションサーバと呼ぶ。Webアプリケーションサーバは、</p>
<p>その上で複数のサーバプログラムを動作させ、様々なサービスを提供する。 Webアプリケーションサーバは、通常のWebサーバと同じHTTPを用いてブラウザと通信を行うため、Webアプリケーションは 通常のWWWのコンテンツの閲覧と同様にブラウザを用いて利用することができる。</p>
<h1 id="httpリクエスト-レスポンスの内容について">HTTPリクエスト / レスポンスの内容について</h1>
<p>HTTPとはWebサーバとWebクライアントの間でデータの送受信を行うために用いられるプロトコルであり、HTTPでサーバと クライアントがやり取りするメッセージは基本的に以下の形式になっている。 なお、記号　“↩︎” は改行を表している。</p>
<pre><code>メッセージヘッダ ↩︎
↩︎
メッセージボディ ↩︎</code></pre>
<p>まず、リクエストメッセージについて説明する。以下のリクエストは、リクエストメソッド がGETであるので、メッセージボディは存在しない。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb2-1" data-line-number="1">GET /HTTP/1.1 ↩︎</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">telnet localhost 80 ↩︎</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">↩︎</a></code></pre></div>
<p>メッセージヘッダの１行目では、”リクエストメソッド、リクエストURL、HTTPのバージョン”が “GET /HTTP/1.1” であることを表している。すなわち、 HTTPの1.1バージョンの通信で、GETというリクエストの方法でクライアントからサーバに要求している ことを意味する。</p>
<p>HTTPのメソッドは、その用途によってGETとPOSTで使い分ける。</p>
<p>###GETメソッド HTTP通信でサーバから情報を取得する時に使用する。GETでのサーバへのデータの送信方法として、 リクエストURLの後に？に続いて情報を送信する方式であるクエリストリングがある。 URL の末尾に「？」マークを付け、続けて「名前＝値」の形式で記述する。値が複数春時は「＆」 で区切り記述する。</p>
<pre><code>htt:// example.com/index.html?name1=value&amp;name2=value2</code></pre>
<p>このように送信するデータがアドレスバーに表示されてしまうため、他人に見られる可能性がある。 他人に見られたくない情報はGETでは送らない。</p>
<p>日本語などの文字は、そのままではURLで送信することができないので、 そのような文字をURLに付与して送信するには、パーセントエンコーディングという技術を使用する。</p>
<p>###POSTメソッド HTTP通信で、サーバへ情報を登録する時に使用する。データ量が多い場合、バイナリデータを送信したい 場合、他の人に見られたくない情報を送る場合に使用する。POSTでサーバにデータを送信する際は、 メッセージボディにデータが記述される。 以下に、POSTでのサーバからクライアントへのリクエスト例を示す。</p>
<pre><code>POST /test/ HTTP/1.1
Hsot: localhost
Content-Length: 25
Content-Type: application/x-www-formーurlencoded

name1=value1&amp;name2=value2</code></pre>
<p>上記のように、リクエストヘッダの後に一行、空行が入り、その後POSTで送信したクエリストリング が、リクエストボディとしてクライアントからサーバへと送信される。リクエストボディの長さは 、「Content-Length:」という項目で表される。 次に、レスポンスメッセージについて説明する。いかに具体例を示す。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb5-1" data-line-number="1">HTTP/1.1/ 200 OK</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">Content-Type: text/html</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">Date: Mon, 3 Sep 2017 00:00:00 GMT</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">Last-Modified: Fri, 1 Sep 2017 00:00:00 GMT</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">Accept-Ranges: bytes</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">Etag: &quot;011be787cw2f41&quot;</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">Server: Apache/2.4.27(Unix)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="kw">&lt;title&gt;</span>Sample<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="kw">&lt;p&gt;</span>Hello!<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<p>メッセージヘッダの一行目はステータスラインであり、”HTTPのバージョン、ステータスコード” を表している。ステータスコードを以下の表に示す。</p>
<table>
<caption>ステータスコード</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ステータスコード</th>
<th style="text-align: left;">内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1xx</td>
<td style="text-align: left;">情報</td>
</tr>
<tr class="even">
<td style="text-align: left;">2xx</td>
<td style="text-align: left;">成功</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3xx</td>
<td style="text-align: left;">リダイレクション</td>
</tr>
<tr class="even">
<td style="text-align: left;">4xx</td>
<td style="text-align: left;">クライアントエラー</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5xx</td>
<td style="text-align: left;">サーバエラー</td>
</tr>
</tbody>
</table>
<p>残りのヘッダ部分にはリクエスト先のウェブサーバの情報等が記載されている。 メッセージボディ部分が、クライアント側で表示される内容となっている。</p>
<h1 id="mvcモデルの仕組みについて">MVCモデルの仕組みについて</h1>
<p>MVCは、Model, View, Controllerの三つに役割を分割させたコーディングモデルで ユーザインターフェースをもつアプリケーションを実装するためのデザインパターンである。 アプリケーションの内部データをユーザが直接参照、編集する情報から分離する。 そのためにアプリケーションを三つの部分に分割する。</p>
<p>主な役割は以下のようになる。</p>
<ul>
<li>Model
<ul>
<li>データの改変とそれをViewに伝える。アプリケーションデータ、ビジネスロジック、 アプリケーションが扱う領域のデータと手続きを表現する要素である。 ここで、ビジネスロジックとは、ビジネスオブジェクトをモデル化したデータベース上のデータに対する 処理手順を示す。</li>
</ul></li>
<li>View
<ul>
<li>表示と入出力。グラフや図などの任意の情報表現モデルのデータを取り出してユーザが見るのに適した 形で表示する要素である。すなわち、UIへの出力を担当する。Webアプリケーションでは HTML文章を生成して動的にデータを表示するための部分にあたる。</li>
</ul></li>
<li>Controller
<ul>
<li>ユーザーの入力に基づいた，ModelとViewの制御。入力を受け取りmodelとviewへの命令に変換する ユーザからの入力（通常イベントとして通知される。）をモデルへのメッセージへと変換してモデルに 伝える要素である。すなわち、UIからの入力を担当する。モデルに変更を引き起こす場合もあるが、 直接に描画を行なったり、モデルの内部データを直接操作したりはしない。</li>
</ul></li>
</ul>
<figure>
<img src="./pic2.jpg?fixOrientation" alt="すごい図" /><figcaption>すごい図</figcaption>
</figure>
<p>Webアプリケーションにおける一連の動作を図２に示す。まず、クライアントであるユーザがブラウザを 利用してサーバにリクエストを投げる。このリクエストがコントローラに到着すると、 モデルと通信し必要とされるデータの取得または保存操作が実行される。次に、この通信が終わると、 コントローラはモデルから提供されたデータに基づく結果を生成するタスクを適切なビューに渡す。 最後にビューで生成された出力がクライアントに返されて、 その内容がユーザのブラウザに対して描画される。</p>
<p>開発において、 機能ごとの分離が明確になることによって、それぞれの独立性が保たれ、分業がしやすくなり、 各分野の実装に集中することができる。 また、各要素間の依存性が最小限に抑えられるため、 ほかの部分の変更による影響を受けにくく実装にすることが可能となる。これにより 各要素の再利用性が高まる。 また、変更を加えた際、複数の担当者が同一のソースに対してメンテナンスを行う ことが減り、保守性も確保されるなどのメリットがある。</p>
<h1 id="フレームワークのメリットデメリットについて">フレームワークのメリット、デメリットについて</h1>
<p>Webフレームワークとは、Webアプリケーションの開発をサポートするために設計された クラスやライブラリの集まりである。フレームワークの目的は、Web開発で用いられる共通した 作業に伴う労力を軽減することである。主な機能としては、データベースへのアクセスのための ライブラリ、ルーティング、テンプレートエンジン、セッション管理を提供している。 Webフレームワークを用いることにより、本格的なWebアプリケーション開発が可能になる。 なお、ルーティングとは、リクエストされたURLをそれに対応したHTMLを生成するコードに 割り当てるプロセスのことである。</p>
<h2 id="フレームワークのメリット">フレームワークのメリット</h2>
<h3 id="早く作ることができる">早く作ることができる。</h3>
<p>あらかじめよく使う機能が提供されているため一度フレームワークの仕様自体を把握してしまえば 開発効率を上げることができる。</p>
<h3 id="コーディングスタイルの統一化">コーディングスタイルの統一化</h3>
<p>フレームワークはコーデイングスタイルをある程度統一することによって 複数人の開発において保守性を高めることができる。</p>
<h2 id="フレームワークのデメリット">フレームワークのデメリット</h2>
<h3 id="フレームワークへの依存">フレームワークへの依存</h3>
<p>フレームワークにより処理の詳細がラップされてしまうため。 深い知識がなくてもプロダクトができてしまう。 そのため、バグの特定に時間がかかってしまうなど、 保守・運用などで支障をきたすことがある。</p>
<h3 id="フレームワークでサポートされていない機能を追加しづらい">フレームワークでサポートされていない機能を追加しづらい</h3>
<p>フレームワークでサポートされていない機能を追加する際、一から 全て実装しなければならない時があるが、フレームワークを使う必要性が なくなってしまう。</p>
<h1 id="実験中に説明演習したことについて">実験中に説明・演習したことについて</h1>
<h2 id="telenet-の接続">telenet の接続</h2>
<p>　Telnetは、ネットワークに接続された機器を遠隔操作するために使用するアプリケーション層プロトコル。 　マシンルームにあるサーバ、ルータ等の機器をパソコン上で操作することができる。 パスワード情報を含め全てのデータが暗号化されずに送信される ### 接続方法 cygwin にて</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="ex">GET</span> telenet localhost 80</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="ex">Host</span>: local host</a></code></pre></div>
<p>とコマンドを打つとlocalhost 80 にあるサイトに接続し、 情報を標準出力に出すことができる。 ## URL の構成 URLは以下の３つないしつの構成に分けられる。</p>
<h3 id="スキーム">スキーム</h3>
<p>インターネット上にあるそのリソースへのアクセスに使用されるプロトコルを識別する。 すなわち、HTTP (SSL なし) または HTTPS (SSL あり) のいずれである。</p>
<h3 id="ホスト">ホスト</h3>
<p>そのリソースを保持するホストを識別する。 サーバーはホストの名前でサービスを提供するが。 ホストとサーバーの間で 1 対 1 のマッピングは行われていない。 ホスト名の後にポート番号が付く場合もある。 サービスの予約済みポート番号は、通常 URL から省略されている。 ほとんどのサーバーは、HTTP および HTTPS 用に予約済みのポート番号を使用するため、 HTTP URL からポート番号は除外される。</p>
<h3 id="パス">パス。</h3>
<p>Web クライアントがアクセスする、ホスト内の特定のリソースを識別する。</p>
<h3 id="照会ストリング">照会ストリング。</h3>
<p>照会ストリングが使用される場合はパス構成要素 の後に付加され、 そのリソースの使用目的に関する情報ストリングを提供します。 照会ストリングは通常、名前と値がペアになったストリングである。 名前と値のペアは、(&amp;) で互いに分離されます。</p>
<h2 id="crudについて">CRUDについて</h2>
<p>RUD（クラッド）とは、データを参照する際に必要な最小限の機能のことで以下４つのイニシャルの略である。</p>
<p>Create（生成）、Read（読み取り）、Update（更新）、Delete（削除）</p>
<p>ユーザインタフェースが備えるべき機能（情報の参照/検索/更新）を指す用語としても使われる。</p>
<p>データベースシステムの完全性を備えるためには、CRUDのそれぞれの機能を取り入れる必要がある。</p>
<h2 id="課題の説明と考察">課題１、２、３の説明と考察</h2>
<h3 id="課題-1">課題 1</h3>
<h4 id="説明">説明</h4>
<p>Slim framework とTwing を利用して、消費税計算機Webアプリケーションを作成する。 index.phpのコードは以下のようになった</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">&lt;?php</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">require</span> <span class="st">&#39;vendor/autoload.php&#39;</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="kw">$app</span> = <span class="kw">new</span> \Slim\App<span class="ot">();</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="kw">$loader</span> = <span class="kw">new</span> Twig_Loader_Filesystem<span class="ot">(</span><span class="st">&#39;templates&#39;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="kw">$twig</span> = <span class="kw">new</span> Twig_Environment<span class="ot">(</span><span class="kw">$loader</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw">$app</span>-&gt;get<span class="ot">(</span><span class="st">&#39;/&#39;</span><span class="ot">,</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">$request</span><span class="ot">,</span> <span class="kw">$response</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">)</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$twig</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">    <span class="kw">$data</span> = <span class="ot">[];</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> = <span class="dv">100</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">    <span class="kw">$html</span> = <span class="kw">$twig</span>-&gt;render<span class="ot">(</span><span class="st">&#39;tax.html&#39;</span><span class="ot">,</span> <span class="kw">$data</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">    <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="kw">$html</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">}<span class="ot">);</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="kw">$app</span>-&gt;post<span class="ot">(</span><span class="st">&#39;/&#39;</span><span class="ot">,</span> <span class="kw">function</span><span class="ot">(</span><span class="kw">$request</span><span class="ot">,</span> <span class="kw">$response</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">)</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$twig</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">    <span class="kw">$data</span> = <span class="kw">$request</span>-&gt;getParsedBody<span class="ot">();</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"></a>
<a class="sourceLine" id="cb7-19" data-line-number="19">    <span class="kw">if</span> <span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;field&#39;</span><span class="ot">]</span> == <span class="st">&quot;include&quot;</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb7-20" data-line-number="20">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;rate&#39;</span><span class="ot">]</span> = <span class="dv">8</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;taxinclude&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">];</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;tax&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> / <span class="fl">0.08</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;taxexclude&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> / <span class="fl">1.08</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24">    } <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb7-25" data-line-number="25">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;rate&#39;</span><span class="ot">]</span> = <span class="dv">8</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;taxinclude&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> * <span class="fl">1.08</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;tax&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> * <span class="fl">0.08</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;taxexclude&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">];</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29">    }</a>
<a class="sourceLine" id="cb7-30" data-line-number="30"></a>
<a class="sourceLine" id="cb7-31" data-line-number="31">    <span class="kw">$html</span> = <span class="kw">$twig</span>-&gt;render<span class="ot">(</span><span class="st">&#39;tax.html&#39;</span><span class="ot">,</span> <span class="kw">$data</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb7-32" data-line-number="32">    <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="kw">$html</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33">}<span class="ot">);</span></a>
<a class="sourceLine" id="cb7-34" data-line-number="34"></a>
<a class="sourceLine" id="cb7-35" data-line-number="35"><span class="kw">$app</span>-&gt;run<span class="ot">();</span></a></code></pre></div>
<p>またtax.htmlの中身は以下のようになった</p>
<p>まずpost関数の方の最後にも</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">$html</span> = <span class="kw">$twig</span>-&gt;render<span class="ot">(</span><span class="st">&#39;tax.html&#39;</span><span class="ot">,</span> <span class="kw">$data</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="kw">$html</span><span class="ot">);</span></a></code></pre></div>
<p>を入れるこれによりpost関数の操作がレンダリングされるようになる。 次にpost関数内の</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">if</span> <span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;field&#39;</span><span class="ot">]</span> == <span class="st">&quot;include&quot;</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;rate&#39;</span><span class="ot">]</span> = <span class="dv">8</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;taxinclude&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">];</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;tax&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> / <span class="fl">0.08</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;taxexclude&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> / <span class="fl">1.08</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">} <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;rate&#39;</span><span class="ot">]</span> = <span class="dv">8</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;taxinclude&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> * <span class="fl">1.08</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">  <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;tax&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> * <span class="fl">0.08</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;taxexclude&#39;</span><span class="ot">]</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">];</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">}</a></code></pre></div>
<p>の部分について説明する。まずifでの評価であるが後述するtax.htmlにて 税込のラジオボタンには</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb10-1" data-line-number="1">name=&quot;field&quot; value=&quot;include&quot;</a></code></pre></div>
<p>が、 税抜きのラジオボタンには</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb11-1" data-line-number="1">name=&quot;field&quot; value=&quot;exclude&quot; </a></code></pre></div>
<p>と記述したので</p>
<p><code>$data['field']</code> には税込みの場合は<code>include</code>が 税抜きの場合には<code>exclude</code>が入っているはずなのでそれにより 処理を変える。 税込みの場合には0.08で割ってやり税抜きの場合には0.08で掛けてやれば良い</p>
<p>またtax.htmlは以下のようになる。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;ja&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">    <span class="kw">&lt;title&gt;</span>消費税計算機<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="kw">&lt;h1&gt;</span>消費税計算機<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="kw">&lt;form</span><span class="ot"> action=</span><span class="st">&quot;&quot;</span><span class="ot"> method=</span><span class="st">&quot;POST&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">    <span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11">      <span class="kw">&lt;label&gt;</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12">        金額     <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;number&quot;</span><span class="ot"> name=</span><span class="st">&quot;price&quot;</span><span class="ot"> value=</span><span class="st">{{price}}</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">      <span class="kw">&lt;/label&gt;</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14">    <span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"></a>
<a class="sourceLine" id="cb12-16" data-line-number="16">    <span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;radio&quot;</span><span class="ot"> name=</span><span class="st">&quot;field&quot;</span><span class="ot"> value=</span><span class="st">&quot;include&quot;</span> <span class="er">{%</span><span class="ot"> if not rate or mode</span> <span class="ot">=</span><span class="st">=</span> <span class="er">&#39;include&#39;</span> <span class="er">%}checked</span> <span class="er">{%</span><span class="ot"> endif</span> <span class="er">%}</span><span class="kw">&gt;</span>税込金額</a>
<a class="sourceLine" id="cb12-18" data-line-number="18">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;radio&quot;</span><span class="ot"> name=</span><span class="st">&quot;field&quot;</span><span class="ot"> value=</span><span class="st">&quot;exclude&quot;</span> <span class="er">{%</span><span class="ot"> if not rate or mode</span> <span class="ot">=</span><span class="st">=</span> <span class="er">&#39;exclude&#39;</span> <span class="er">%}checked</span> <span class="er">{%</span><span class="ot"> endif</span> <span class="er">%}</span><span class="kw">&gt;</span>税抜金額</a>
<a class="sourceLine" id="cb12-19" data-line-number="19">    <span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"></a>
<a class="sourceLine" id="cb12-21" data-line-number="21">    <span class="kw">&lt;p&gt;&lt;input</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value=</span><span class="st">&quot;送信&quot;</span><span class="kw">&gt;&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="kw">&lt;/form&gt;</span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="kw">&lt;table</span><span class="ot"> border=</span><span class="st">&quot;1&quot;</span><span class="kw">&gt;</span> </a>
<a class="sourceLine" id="cb12-24" data-line-number="24">  <span class="kw">&lt;tr&gt;</span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"></a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="kw">&lt;label&gt;</span></a>
<a class="sourceLine" id="cb12-27" data-line-number="27">    <span class="kw">&lt;td&gt;</span>消費税率<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb12-28" data-line-number="28">    <span class="kw">&lt;td&gt;</span>税抜金額<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb12-29" data-line-number="29">    <span class="kw">&lt;td&gt;</span>消費税<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb12-30" data-line-number="30">    <span class="kw">&lt;td&gt;</span>税込金額&lt;/td&gt;</a>
<a class="sourceLine" id="cb12-31" data-line-number="31">  <span class="kw">&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb12-32" data-line-number="32">  <span class="kw">&lt;tr&gt;</span></a>
<a class="sourceLine" id="cb12-33" data-line-number="33">    <span class="kw">&lt;td&gt;</span>{{rate}}％&lt;/td&gt;</a>
<a class="sourceLine" id="cb12-34" data-line-number="34">    <span class="kw">&lt;td&gt;</span>{{taxexclude}}円<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb12-35" data-line-number="35">    <span class="kw">&lt;td&gt;</span>{{tax}}円<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb12-36" data-line-number="36">    <span class="kw">&lt;td&gt;</span>{{taxinclude}}円<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb12-37" data-line-number="37">  <span class="kw">&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb12-38" data-line-number="38"><span class="kw">&lt;/table&gt;</span></a>
<a class="sourceLine" id="cb12-39" data-line-number="39"><span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb12-40" data-line-number="40"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<p>はじめにラジオボタンを書いた。その後 index.phpにて内部処理が計算されその結果がtax.htmlに渡ってくる。 それらをTwingにより表示する。</p>
<h4 id="考察">考察</h4>
<p>今回はMVCにおけるコントローラとしてSlim、ビューとしてTwigを使っている index.htmlにおいて</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">$html</span> = <span class="kw">$twig</span>-&gt;render<span class="ot">(</span><span class="st">&#39;tax.html&#39;</span><span class="ot">,</span> <span class="kw">$data</span><span class="ot">);</span></a></code></pre></div>
<p>の一行が見られるがこれよりtwig でtax.htmlと<code>$data</code>が 使えるようになっていることが確認できる。 以前 flask, Django を勉強した経験があったがMVCモデル（DjangoはMVCではないけども) について理解しておらず。うまく使いこなすことができなかった。</p>
<p>今回Slim, Twingというフルスタックでないフレームワークを通して コントローラ、ビューはMVCの中でそれぞれの役割が明確になる。</p>
<h3 id="課題-2">課題 2</h3>
<h4 id="説明-1">説明</h4>
<p>index.phpは以下のようになった。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">&lt;?php</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">require</span> <span class="st">&#39;vendor/autoload.php&#39;</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">// データベース接続</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="kw">try</span> {</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    <span class="kw">$pdo</span> = <span class="kw">new</span> <span class="kw">PDO</span><span class="ot">(</span><span class="st">&#39;sqlite:vending.db&#39;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7">} <span class="kw">catch</span> <span class="ot">(</span><span class="kw">PDOException</span> <span class="kw">$e</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">    <span class="kw">die</span><span class="ot">(</span><span class="st">&quot;データベース接続失敗&quot;</span> . <span class="kw">$e</span>-&gt;getMessage<span class="ot">());</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">// テーブル作成</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="kw">$pdo</span>-&gt;<span class="fu">exec</span><span class="ot">(</span><span class="st">&quot;create table if not exists items (</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="st">    id    integer primary key autoincrement,</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="st">    name  varchar,</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="st">    price integer,</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="st">    num   integer)&quot;</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">// SLIM framework の準備</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="kw">$app</span> = <span class="kw">new</span> \Slim\App<span class="ot">();</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">// twig の準備</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="kw">$loader</span> = <span class="kw">new</span> Twig_Loader_Filesystem<span class="ot">(</span><span class="st">&#39;templates&#39;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="kw">$twig</span> = <span class="kw">new</span> Twig_Environment<span class="ot">(</span><span class="kw">$loader</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"></a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="co">//----------------------------------</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="co">// ルーティング</span></a>
<a class="sourceLine" id="cb14-27" data-line-number="27"><span class="co">//----------------------------------</span></a>
<a class="sourceLine" id="cb14-28" data-line-number="28"><span class="kw">$app</span>-&gt;get<span class="ot">(</span><span class="st">&#39;/&#39;</span><span class="ot">,</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">$request</span><span class="ot">,</span> <span class="kw">$response</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">)</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$twig</span><span class="ot">,</span> <span class="kw">$pdo</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb14-29" data-line-number="29">    <span class="kw">$data</span> = <span class="ot">[];</span></a>
<a class="sourceLine" id="cb14-30" data-line-number="30">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;pay&#39;</span><span class="ot">]</span> = <span class="dv">0</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-31" data-line-number="31"></a>
<a class="sourceLine" id="cb14-32" data-line-number="32">    <span class="kw">$stmt</span> = <span class="kw">$pdo</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;SELECT * FROM items&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-33" data-line-number="33">    <span class="kw">$stmt</span>-&gt;execute<span class="ot">();</span></a>
<a class="sourceLine" id="cb14-34" data-line-number="34">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">]</span> = <span class="kw">$stmt</span>-&gt;fetchALL<span class="ot">();</span></a>
<a class="sourceLine" id="cb14-35" data-line-number="35"></a>
<a class="sourceLine" id="cb14-36" data-line-number="36">    <span class="kw">$html</span> = <span class="kw">$twig</span>-&gt;render<span class="ot">(</span><span class="st">&#39;machine.html&#39;</span><span class="ot">,</span> <span class="kw">$data</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-37" data-line-number="37">    <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="kw">$html</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-38" data-line-number="38">}<span class="ot">);</span></a>
<a class="sourceLine" id="cb14-39" data-line-number="39"></a>
<a class="sourceLine" id="cb14-40" data-line-number="40"><span class="kw">$app</span>-&gt;post<span class="ot">(</span><span class="st">&#39;/&#39;</span><span class="ot">,</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">$request</span><span class="ot">,</span> <span class="kw">$response</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">)</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$twig</span><span class="ot">,</span> <span class="kw">$pdo</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb14-41" data-line-number="41">    <span class="kw">$data</span> = <span class="kw">$request</span>-&gt;getParsedBody<span class="ot">();</span></a>
<a class="sourceLine" id="cb14-42" data-line-number="42"></a>
<a class="sourceLine" id="cb14-43" data-line-number="43">    <span class="co">// データ表示テスト</span></a>
<a class="sourceLine" id="cb14-44" data-line-number="44">    <span class="co">//echo &quot;&lt;pre&gt;&quot;;</span></a>
<a class="sourceLine" id="cb14-45" data-line-number="45">    <span class="co">//var_dump($data);</span></a>
<a class="sourceLine" id="cb14-46" data-line-number="46">    <span class="co">//echo &quot;&lt;/pre&gt;&quot;;</span></a>
<a class="sourceLine" id="cb14-47" data-line-number="47">    <span class="co">// データ表示テスト</span></a>
<a class="sourceLine" id="cb14-48" data-line-number="48"></a>
<a class="sourceLine" id="cb14-49" data-line-number="49">    <span class="kw">$stmt</span> = <span class="kw">$pdo</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;SELECT * FROM items&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-50" data-line-number="50">    <span class="kw">$stmt</span>-&gt;execute<span class="ot">();</span></a>
<a class="sourceLine" id="cb14-51" data-line-number="51">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">]</span> = <span class="kw">$stmt</span>-&gt;fetchALL<span class="ot">();</span></a>
<a class="sourceLine" id="cb14-52" data-line-number="52"></a>
<a class="sourceLine" id="cb14-53" data-line-number="53"></a>
<a class="sourceLine" id="cb14-54" data-line-number="54">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;buyed&#39;</span><span class="ot">]</span> = <span class="kw">array</span><span class="ot">();</span></a>
<a class="sourceLine" id="cb14-55" data-line-number="55">    <span class="kw">$sum</span> = <span class="dv">0</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-56" data-line-number="56"></a>
<a class="sourceLine" id="cb14-57" data-line-number="57">    <span class="kw">for</span> <span class="ot">(</span><span class="kw">$i</span> = <span class="dv">0</span><span class="ot">;</span> <span class="kw">$i</span> &lt; <span class="fu">count</span><span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;buyitem&#39;</span><span class="ot">]);</span> <span class="kw">$i</span>++<span class="ot">)</span> {</a>
<a class="sourceLine" id="cb14-58" data-line-number="58">        <span class="kw">$sum</span> = <span class="kw">$sum</span> + <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;buyitem&#39;</span><span class="ot">][</span><span class="kw">$i</span> + <span class="dv">1</span><span class="ot">]</span> * <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">][</span><span class="kw">$i</span><span class="ot">][</span><span class="st">&#39;price&#39;</span><span class="ot">];</span></a>
<a class="sourceLine" id="cb14-59" data-line-number="59">    }</a>
<a class="sourceLine" id="cb14-60" data-line-number="60"></a>
<a class="sourceLine" id="cb14-61" data-line-number="61">    <span class="kw">for</span> <span class="ot">(</span><span class="kw">$i</span> = <span class="dv">0</span><span class="ot">;</span> <span class="kw">$i</span> &lt; <span class="fu">count</span><span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;buyitem&#39;</span><span class="ot">]);</span> <span class="kw">$i</span>++<span class="ot">)</span> {</a>
<a class="sourceLine" id="cb14-62" data-line-number="62">        <span class="kw">if</span> <span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;buyitem&#39;</span><span class="ot">][</span><span class="kw">$i</span> + <span class="dv">1</span><span class="ot">]</span> &gt; <span class="dv">0</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb14-63" data-line-number="63">            <span class="fu">array_push</span><span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;buyed&#39;</span><span class="ot">],</span> <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">][</span><span class="kw">$i</span><span class="ot">][</span><span class="st">&#39;name&#39;</span><span class="ot">]);</span></a>
<a class="sourceLine" id="cb14-64" data-line-number="64">        }</a>
<a class="sourceLine" id="cb14-65" data-line-number="65">    }</a>
<a class="sourceLine" id="cb14-66" data-line-number="66"></a>
<a class="sourceLine" id="cb14-67" data-line-number="67">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;result&#39;</span><span class="ot">]</span> = <span class="kw">True</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-68" data-line-number="68">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;sum&#39;</span><span class="ot">]</span> =  <span class="kw">$sum</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-69" data-line-number="69">    <span class="kw">$turi</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;pay&#39;</span><span class="ot">]</span> - <span class="kw">$sum</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-70" data-line-number="70">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;turi&#39;</span><span class="ot">]</span> = <span class="kw">$turi</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-71" data-line-number="71"></a>
<a class="sourceLine" id="cb14-72" data-line-number="72">    <span class="kw">if</span> <span class="ot">(</span><span class="kw">$sum</span> &gt; <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;pay&#39;</span><span class="ot">])</span> {</a>
<a class="sourceLine" id="cb14-73" data-line-number="73">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;lessmoney&#39;</span><span class="ot">]</span> = <span class="st">&quot;投入金額不足&quot;</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-74" data-line-number="74">    }</a>
<a class="sourceLine" id="cb14-75" data-line-number="75">    <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb14-76" data-line-number="76">      <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;lessmoney&#39;</span><span class="ot">]</span> = <span class="st">&quot;&quot;</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb14-77" data-line-number="77">      <span class="kw">for</span> <span class="ot">(</span><span class="kw">$i</span> = <span class="dv">0</span><span class="ot">;</span> <span class="kw">$i</span> &lt; <span class="fu">count</span><span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;buyitem&#39;</span><span class="ot">]);</span> <span class="kw">$i</span>++<span class="ot">)</span> {</a>
<a class="sourceLine" id="cb14-78" data-line-number="78">        <span class="kw">$lest</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">][</span><span class="kw">$i</span><span class="ot">][</span><span class="st">&#39;num&#39;</span><span class="ot">]</span> - <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;buyitem&#39;</span><span class="ot">][</span><span class="kw">$i</span> + <span class="dv">1</span><span class="ot">];</span></a>
<a class="sourceLine" id="cb14-79" data-line-number="79">        <span class="kw">if</span> <span class="ot">(</span><span class="kw">$lest</span> &gt; <span class="dv">0</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb14-80" data-line-number="80">          <span class="kw">$stmt</span> = <span class="kw">$pdo</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;update items set num = ? where id = ?&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-81" data-line-number="81">          <span class="kw">$stmt</span> -&gt; execute<span class="ot">([</span><span class="kw">$lest</span><span class="ot">,</span> <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">][</span><span class="kw">$i</span><span class="ot">][</span><span class="st">&#39;id&#39;</span><span class="ot">]]);</span></a>
<a class="sourceLine" id="cb14-82" data-line-number="82">        }</a>
<a class="sourceLine" id="cb14-83" data-line-number="83">      }</a>
<a class="sourceLine" id="cb14-84" data-line-number="84">    }</a>
<a class="sourceLine" id="cb14-85" data-line-number="85"></a>
<a class="sourceLine" id="cb14-86" data-line-number="86">    <span class="kw">$html</span> = <span class="kw">$twig</span>-&gt;render<span class="ot">(</span><span class="st">&#39;machine.html&#39;</span><span class="ot">,</span> <span class="kw">$data</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-87" data-line-number="87">    <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="kw">$html</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb14-88" data-line-number="88">}<span class="ot">);</span></a>
<a class="sourceLine" id="cb14-89" data-line-number="89"></a>
<a class="sourceLine" id="cb14-90" data-line-number="90"><span class="kw">$app</span>-&gt;run<span class="ot">();</span></a></code></pre></div>
<p>上から順に説明していく。合計額の計算をまず行うこれはベクトルの内積となるので、 for分で記述する際は二変数が必要となるこれらを先にマップしてzipをしてその後、 foreach文で計算させる方法も考えられたが処理数が増え、mapはもともと 命令型のパラダイムでないため、可読性を下げる可能性があり、foreachで少し可読性 は上がるが総括するとシンプルさが下がり命令型のパターンとは外れるのでfor文を採用する に至った。</p>
<p>次に購入した商品リストを作成するためもう一度for文を行なっている 繰り返し回数は上と変わらず上のforぶんの処理の内部にかけるが 今回はあくまで課題であるため速さよりも可読性を重視した。 配列の追加にはもう一つ技巧的な関数を使わない方法があるがこれも可読性の向上のため 関数を呼び出しpushさせている。</p>
<p>合計金額を計算したらそれが支払額より小さいことを確認して支払額よりも 大きかったらユーザに支払額が不足していることを伝えそうでなければ データベースに変更を加える。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;ja&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="kw">&lt;title&gt;</span>自動販売機<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="kw">&lt;form</span><span class="ot"> action=</span><span class="st">&quot;&quot;</span><span class="ot"> method=</span><span class="st">&quot;POST&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="kw">&lt;table&gt;</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10">    <span class="kw">&lt;caption&gt;</span>商品を選んでください<span class="kw">&lt;/caption&gt;</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11">    <span class="kw">&lt;tr&gt;</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">        <span class="kw">&lt;th&gt;</span>商品名<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13">        <span class="kw">&lt;th&gt;</span>価格<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14">        <span class="kw">&lt;th&gt;</span>在庫&lt;/th&gt;</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">        <span class="kw">&lt;th&gt;</span>個数<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16">    <span class="kw">&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17">    {% for item in items %}</a>
<a class="sourceLine" id="cb15-18" data-line-number="18">    <span class="kw">&lt;tr&gt;</span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19">        <span class="kw">&lt;td&gt;</span>{{item.name}}<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb15-20" data-line-number="20">        <span class="kw">&lt;td&gt;</span>{{item.price}}<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21">        <span class="kw">&lt;td&gt;</span>{{item.num}}<span class="kw">&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb15-22" data-line-number="22">        <span class="kw">&lt;td&gt;&lt;input</span><span class="ot"> type=</span><span class="st">&quot;number&quot;</span><span class="ot"> name=</span><span class="st">&quot;buyitem[{{item.id}}]&quot;</span><span class="ot"> value=</span><span class="st">&quot;0&quot;</span><span class="kw">&gt;&lt;/td&gt;</span></a>
<a class="sourceLine" id="cb15-23" data-line-number="23">    <span class="kw">&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb15-24" data-line-number="24">    {% endfor %}</a>
<a class="sourceLine" id="cb15-25" data-line-number="25"><span class="kw">&lt;/table&gt;</span></a>
<a class="sourceLine" id="cb15-26" data-line-number="26"><span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb15-27" data-line-number="27">    <span class="kw">&lt;label&gt;</span></a>
<a class="sourceLine" id="cb15-28" data-line-number="28">        投入額</a>
<a class="sourceLine" id="cb15-29" data-line-number="29">        <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;number&quot;</span><span class="ot"> name=</span><span class="st">&quot;pay&quot;</span><span class="ot"> value=</span><span class="st">&quot;{{pay}}&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb15-30" data-line-number="30">        <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value=</span><span class="st">&quot;購入&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb15-31" data-line-number="31">    <span class="kw">&lt;/label&gt;</span></a>
<a class="sourceLine" id="cb15-32" data-line-number="32"><span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb15-33" data-line-number="33"><span class="kw">&lt;/form&gt;</span></a>
<a class="sourceLine" id="cb15-34" data-line-number="34"></a>
<a class="sourceLine" id="cb15-35" data-line-number="35">{% if result %}</a>
<a class="sourceLine" id="cb15-36" data-line-number="36">  <span class="kw">&lt;p&gt;</span>購入商品: <span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb15-37" data-line-number="37">  {% for b in buyed %}</a>
<a class="sourceLine" id="cb15-38" data-line-number="38">      <span class="kw">&lt;p&gt;</span> {{b}} <span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb15-39" data-line-number="39">  {% endfor %}</a>
<a class="sourceLine" id="cb15-40" data-line-number="40"></a>
<a class="sourceLine" id="cb15-41" data-line-number="41">  <span class="kw">&lt;p&gt;</span>おつり: {{turi}}<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb15-42" data-line-number="42"></a>
<a class="sourceLine" id="cb15-43" data-line-number="43">  <span class="kw">&lt;p&gt;</span>合計金額: {{sum}}<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb15-44" data-line-number="44"></a>
<a class="sourceLine" id="cb15-45" data-line-number="45">  <span class="kw">&lt;p&gt;</span>{{lessmoney}}<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb15-46" data-line-number="46">{% endif %}</a>
<a class="sourceLine" id="cb15-47" data-line-number="47"></a>
<a class="sourceLine" id="cb15-48" data-line-number="48"><span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb15-49" data-line-number="49"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<p>MVCよりビューとコントローラを分離させるため、index.phpの処理のあと結果を そのままindex.php内でそのまま<code>echo</code>や<code>print</code>を使わずに一度 twigにデータを渡し、twigにより結果を表示させる。</p>
<h4 id="考察-1">考察</h4>
<p>今回はtwigにてif文やfor文の使用も行なった。 なぜslimだけでなくtwigにもif文for文があるのかこれはまさにMVCにおける機能の 独立化のためであることがわかる。</p>
<h3 id="課題-3">課題 3</h3>
<p>index.phpのソースコードは以下のようになった</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb16-1" data-line-number="1"></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">//新商品追加</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw">$app</span>-&gt;get<span class="ot">(</span><span class="st">&#39;/insert/{name}/{num}&#39;</span><span class="ot">,</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">$request</span><span class="ot">,</span> <span class="kw">$response</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">)</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$twig</span><span class="ot">,</span> <span class="kw">$pdo</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">    <span class="kw">$stmt</span> = <span class="kw">$pdo</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;insert into items (name, price, num) values (?,?,?)&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">    <span class="kw">$stmt</span>-&gt;execute<span class="ot">([</span><span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">],</span> <span class="dv">0</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;num&#39;</span><span class="ot">]]);</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">    <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="st">&#39;新商品&#39;</span> . <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">]</span> . <span class="st">&#39;を&#39;</span> . <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;num&#39;</span><span class="ot">]</span> . <span class="st">&#39;個追加しました&#39;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8">}<span class="ot">);</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">//商品削除</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="kw">$app</span>-&gt;get<span class="ot">(</span><span class="st">&#39;/delete/{name}&#39;</span><span class="ot">,</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">$request</span><span class="ot">,</span> <span class="kw">$response</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">)</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$twig</span><span class="ot">,</span> <span class="kw">$pdo</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">    <span class="kw">$stmt</span> = <span class="kw">$pdo</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;delete from items where name = ?&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13">    <span class="kw">$stmt</span>-&gt;execute<span class="ot">([</span><span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">]]);</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"></a>
<a class="sourceLine" id="cb16-15" data-line-number="15">    <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="st">&#39;商品&#39;</span> . <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">]</span> . <span class="st">&#39;を削除しました&#39;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16">}<span class="ot">);</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">//価格設定</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="kw">$app</span>-&gt;get<span class="ot">(</span><span class="st">&#39;/set/{name}/{price}&#39;</span><span class="ot">,</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">$request</span><span class="ot">,</span> <span class="kw">$response</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">)</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$twig</span><span class="ot">,</span> <span class="kw">$pdo</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb16-20" data-line-number="20">    <span class="kw">$stmt</span> = <span class="kw">$pdo</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;update items set price = ? where name = ?&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21">    <span class="kw">$stmt</span>-&gt;execute<span class="ot">([</span><span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">],</span> <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">]]);</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22">    <span class="co">//$stmt-&gt;execute([$args[&#39;price&#39;]], [$args[&#39;name&#39;]]);</span></a>
<a class="sourceLine" id="cb16-23" data-line-number="23"></a>
<a class="sourceLine" id="cb16-24" data-line-number="24">    <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="st">&#39;商品&#39;</span> . <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">]</span> . <span class="st">&#39;の価格を&#39;</span> . <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;price&#39;</span><span class="ot">]</span> . <span class="st">&#39;に変更しました&#39;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25">}<span class="ot">);</span></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">//数量追加</span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="kw">$app</span>-&gt;get<span class="ot">(</span><span class="st">&#39;/add/{name}/{num}&#39;</span><span class="ot">,</span> <span class="kw">function</span> <span class="ot">(</span><span class="kw">$request</span><span class="ot">,</span> <span class="kw">$response</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">)</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$twig</span><span class="ot">,</span> <span class="kw">$pdo</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb16-29" data-line-number="29">    <span class="kw">$stmt</span> = <span class="kw">$pdo</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;SELECT * FROM items&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30">    <span class="kw">$stmt</span>-&gt;execute<span class="ot">();</span></a>
<a class="sourceLine" id="cb16-31" data-line-number="31">    <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">]</span> = <span class="kw">$stmt</span>-&gt;fetchALL<span class="ot">();</span></a>
<a class="sourceLine" id="cb16-32" data-line-number="32"></a>
<a class="sourceLine" id="cb16-33" data-line-number="33">    <span class="kw">$doflag</span> = <span class="dv">0</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb16-34" data-line-number="34">    <span class="kw">for</span> <span class="ot">(</span><span class="kw">$i</span> = <span class="dv">0</span><span class="ot">;</span> <span class="kw">$i</span> &lt; <span class="fu">count</span><span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">]);</span> <span class="kw">$i</span>++<span class="ot">)</span> {</a>
<a class="sourceLine" id="cb16-35" data-line-number="35">        <span class="kw">if</span> <span class="ot">(</span><span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">][</span><span class="kw">$i</span><span class="ot">][</span><span class="st">&#39;name&#39;</span><span class="ot">]</span> == <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">])</span> {</a>
<a class="sourceLine" id="cb16-36" data-line-number="36">            <span class="kw">$doflag</span> = <span class="dv">1</span><span class="ot">;</span>    </a>
<a class="sourceLine" id="cb16-37" data-line-number="37">            <span class="kw">$newnum</span> = <span class="kw">$data</span><span class="ot">[</span><span class="st">&#39;items&#39;</span><span class="ot">][</span><span class="kw">$i</span><span class="ot">][</span><span class="st">&#39;num&#39;</span><span class="ot">]</span> + <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;num&#39;</span><span class="ot">];</span></a>
<a class="sourceLine" id="cb16-38" data-line-number="38">        }</a>
<a class="sourceLine" id="cb16-39" data-line-number="39">    }</a>
<a class="sourceLine" id="cb16-40" data-line-number="40"></a>
<a class="sourceLine" id="cb16-41" data-line-number="41">    <span class="kw">if</span> <span class="ot">(</span><span class="kw">$doflag</span> == <span class="dv">1</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb16-42" data-line-number="42">        <span class="kw">$stmt</span> = <span class="kw">$pdo</span>-&gt;prepare<span class="ot">(</span><span class="st">&quot;update items set num = ? where name = ?&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-43" data-line-number="43">        <span class="kw">$stmt</span>-&gt;execute<span class="ot">([</span><span class="kw">$newnum</span><span class="ot">,</span> <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">]]);</span></a>
<a class="sourceLine" id="cb16-44" data-line-number="44">        <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="st">&#39;商品&#39;</span> . <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">]</span> . <span class="st">&#39;の個数を&#39;</span> . <span class="kw">$newnum</span> . <span class="st">&#39;に変更しました&#39;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-45" data-line-number="45">    }</a>
<a class="sourceLine" id="cb16-46" data-line-number="46">    <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb16-47" data-line-number="47">        <span class="kw">return</span> <span class="kw">$response</span>-&gt;write<span class="ot">(</span><span class="st">&#39;商品&#39;</span> . <span class="kw">$args</span><span class="ot">[</span><span class="st">&#39;name&#39;</span><span class="ot">]</span> . <span class="st">&quot;は見つかりませんでした&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb16-48" data-line-number="48">    }</a></code></pre></div>
<h4 id="説明-2">説明</h4>
<h5 id="商品削除について">商品削除について</h5>
<h5 id="価格設定について">価格設定について</h5>
<h5 id="数量追加について">数量追加について</h5>
<h4 id="考察-2">考察</h4>
</body>
</html>
